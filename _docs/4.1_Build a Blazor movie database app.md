# ğŸ¬ Blazor film veritabanÄ± uygulamasÄ± oluÅŸturma (BÃ¶lÃ¼m 2 - Model ekleme ve iskelet oluÅŸturma)

## ğŸ§° AraÃ§larÄ±nÄ±zÄ± seÃ§in

Bu makale, film veritabanÄ± yÃ¶netimi Ã¶zelliklerine sahip bir **ASP.NET Core Blazor Web UygulamasÄ±** oluÅŸturmayÄ± Ã¶ÄŸreten serinin ikinci bÃ¶lÃ¼mÃ¼dÃ¼r.

Bu bÃ¶lÃ¼mde ÅŸunlarÄ± Ã¶ÄŸreneceksiniz:

* VeritabanÄ±ndaki bir filmi temsil eden bir **sÄ±nÄ±f** eklemek,
* **Entity Framework Core (EF Core)** ile veritabanÄ± baÄŸlamÄ± ve veritabanÄ±nÄ± oluÅŸturmak,
* EF Core araÃ§larÄ±nÄ± ve Razor bileÅŸen tabanlÄ± kullanÄ±cÄ± arayÃ¼zÃ¼nÃ¼ otomatik olarak Ã¼retmek (scaffolding).

---

## ğŸï¸ Veri modeli ekleme

1. Projeye **Models** adlÄ± bir klasÃ¶r ekleyin.
2. Bu klasÃ¶re **Movie.cs** adlÄ± bir sÄ±nÄ±f dosyasÄ± ekleyin.
3. DosyanÄ±n iÃ§eriÄŸini aÅŸaÄŸÄ±daki ÅŸekilde oluÅŸturun:

```csharp
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace BlazorWebAppMovies.Models;

public class Movie
{
    public int Id { get; set; }

    public string? Title { get; set; }

    public DateOnly ReleaseDate { get; set; }

    public string? Genre { get; set; }

    [DataType(DataType.Currency)]
    [Column(TypeName = "decimal(18, 2)")]
    public decimal Price { get; set; }
}
```

### ğŸ¬ Movie sÄ±nÄ±fÄ± Ã¶zellikleri

* **Id:** Her kayÄ±t iÃ§in birincil anahtar (primary key) olarak kullanÄ±lÄ±r. EF Core, kayÄ±tlarÄ± takip etmek iÃ§in bu Ã¶zelliÄŸe ihtiyaÃ§ duyar.
* **Title:** Filmin adÄ±
* **ReleaseDate:** YayÄ±n tarihi
* **Genre:** TÃ¼r
* **Price:** Fiyat

â“ `string?` ifadesi, Ã¶zelliÄŸin **null** olabileceÄŸini belirtir (nullable).

---

## ğŸ’¡ EF Core veri tipi seÃ§imi

EF Core, modeldeki .NET veri tÃ¼rlerine gÃ¶re veritabanÄ± sÃ¼tun tÃ¼rlerini belirler.

AyrÄ±ca `System.ComponentModel.DataAnnotations` Ã¶zniteliklerini de dikkate alÄ±r.

Bir Ã¶znitelik aÅŸaÄŸÄ±daki biÃ§imde tanÄ±mlanÄ±r:

```csharp
[{ANNOTATION}]
```

Birden fazla Ã¶znitelik kullanÄ±lacaksa, aynÄ± satÄ±rda virgÃ¼lle ayÄ±rabilir veya ayrÄ± satÄ±rlarda yazabilirsiniz.

### ğŸ’° Price Ã¶zelliÄŸi aÃ§Ä±klamalarÄ±

```csharp
[DataType(DataType.Currency)]
[Column(TypeName = "decimal(18, 2)")]
public decimal Price { get; set; }
```

Bu aÃ§Ä±klamalar ÅŸunlarÄ± belirtir:

* Ã–zelliÄŸin **para birimi** tÃ¼rÃ¼nde olduÄŸunu,
* VeritabanÄ± sÃ¼tununun **ondalÄ±k (decimal)** 18 haneli ve 2 ondalÄ±k basamaklÄ± olduÄŸunu.

> ğŸ“˜ Ä°lerleyen bÃ¶lÃ¼mlerde doÄŸrulama (validation) Ã¶zniteliklerinin nasÄ±l kullanÄ±lacaÄŸÄ± aÃ§Ä±klanacaktÄ±r.

---

## ğŸ“¦ NuGet paketlerini ve araÃ§larÄ±nÄ± ekleme

1. **Terminal** penceresini aÃ§Ä±n ( **Terminal menÃ¼sÃ¼ > New Terminal** ).
2. AÅŸaÄŸÄ±daki komutlarÄ± tek seferde yapÄ±ÅŸtÄ±rÄ±n ve Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
dotnet tool install --global dotnet-aspnet-codegenerator
dotnet tool install --global dotnet-ef
dotnet add package Microsoft.EntityFrameworkCore.SQLite
dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design
dotnet add package Microsoft.EntityFrameworkCore.SqlServer
dotnet add package Microsoft.EntityFrameworkCore.Tools
dotnet add package Microsoft.AspNetCore.Components.QuickGrid
dotnet add package Microsoft.AspNetCore.Components.QuickGrid.EntityFrameworkAdapter
dotnet add package Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore
```

> âš ï¸ Ä°lk sekiz komut Ã§alÄ±ÅŸtÄ±ktan sonra, **son komutu Ã§alÄ±ÅŸtÄ±rmak iÃ§in Enterâ€™a basmayÄ± unutmayÄ±n.**

> ğŸ’¬ Bu komutlar, VS Code Terminalâ€™inde **PowerShell** kabuÄŸunda Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.

Komutlar tamamlandÄ±ktan sonra  **proje dosyasÄ±nÄ± kaydedin** .

---

### ğŸ“˜ Eklenen paketler

* EF Core **CLI araÃ§larÄ±** (`dotnet-ef`)
* **dotnet-aspnet-codegenerator:** kod iskeleti oluÅŸturucu
* **Microsoft.EntityFrameworkCore.Tools:** tasarÄ±m zamanÄ± araÃ§larÄ±
* **Microsoft.EntityFrameworkCore.SQLite / SqlServer:** veritabanÄ± saÄŸlayÄ±cÄ±larÄ±
* **Microsoft.VisualStudio.Web.CodeGeneration.Design:** scaffolding desteÄŸi
* **Microsoft.AspNetCore.Diagnostics.EntityFrameworkCore:** veritabanÄ± hatasÄ± filtreleme desteÄŸi
* **QuickGrid** ve **QuickGrid.EntityFrameworkAdapter:** tablo bileÅŸenleri iÃ§in

---

## ğŸ§± Projeyi derleme

VS Code  **Command Palette** â€™te ( **Ctrl+Shift+P** ) ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```
.NET: Build
```

Derlemenin baÅŸarÄ±lÄ± olduÄŸundan emin olun.

---

## âš™ï¸ Modelin iskeletini (scaffold) oluÅŸturma

EF Coreâ€™un **scaffolding** Ã¶zelliÄŸi, veri modeliyle Ã§alÄ±ÅŸan veritabanÄ± ve kullanÄ±cÄ± arayÃ¼zÃ¼ kodunu otomatik olarak oluÅŸturur.

Terminalde (proje kÃ¶k dizininde) aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
dotnet aspnet-codegenerator blazor CRUD -dbProvider sqlite -dc BlazorWebAppMovies.Data.BlazorWebAppMoviesContext -m Movie -outDir Components/Pages
```

---

### ğŸ§© Komut parametreleri aÃ§Ä±klamasÄ±

| Parametre       | AÃ§Ä±klama                                                                                       |
| --------------- | ------------------------------------------------------------------------------------------------ |
| `-dbProvider` | VeritabanÄ± saÄŸlayÄ±cÄ±sÄ± (sqlite, sqlserver, cosmos, postgres).                               |
| `-dc`         | DbContext sÄ±nÄ±fÄ± ve ad alanÄ± (Ã¶rnek:`BlazorWebAppMovies.Data.BlazorWebAppMoviesContext`). |
| `-m`          | Model adÄ± (`Movie`).                                                                          |
| `-outDir`     | OluÅŸturulacak bileÅŸenlerin klasÃ¶rÃ¼ (`Components/Pages`).                                   |

Bu komut aÅŸaÄŸÄ±daki CRUD (Create, Read, Update, Delete) bileÅŸenlerini Ã¼retir:

* **Create.razor** â€“ Yeni film ekleme
* **Edit.razor** â€“ Film dÃ¼zenleme
* **Delete.razor** â€“ Film silme
* **Details.razor** â€“ Film detaylarÄ±nÄ± gÃ¶rÃ¼ntÃ¼leme
* **Index.razor** â€“ Film listesini gÃ¶sterme

---

## âš™ï¸ appsettings.json dosyasÄ±

Ä°skelet oluÅŸturucu, yerel veritabanÄ± baÄŸlantÄ± dizesini (connection string) **appsettings.json** dosyasÄ±na ekler:

```json
"ConnectionStrings": {
  "BlazorWebAppMoviesContext": "{CONNECTION STRING}"
}
```

---

âš ï¸ **UyarÄ±:**

Ä°stemci tarafÄ± kodunda aÅŸaÄŸÄ±daki bilgileri  **asla saklamayÄ±n** :

* Uygulama sÄ±rlarÄ±
* BaÄŸlantÄ± dizeleri
* Kimlik bilgileri / parolalar
* PINâ€™ler, Ã¶zel anahtarlar veya tokenâ€™lar

Ãœretim ortamlarÄ±nda gÃ¼venli kimlik doÄŸrulama yÃ¶ntemleri kullanÄ±lmalÄ±dÄ±r.

Yerel geliÅŸtirmede gizli veriler iÃ§in **Secret Manager** aracÄ±nÄ± kullanÄ±n.

ğŸ”— Daha fazla bilgi: *Securely maintain sensitive data and credentials*



# ğŸ¬ Blazor film veritabanÄ± uygulamasÄ± oluÅŸturma (BÃ¶lÃ¼m 2 - Ä°skelet oluÅŸturma sonucu dosyalar ve veritabanÄ± iÅŸlemleri)

## ğŸ—‚ï¸ Ä°skelet oluÅŸturma (Scaffolding) ile oluÅŸturulan dosyalar

Ä°skelet oluÅŸturma iÅŸlemi aÅŸaÄŸÄ±daki **bileÅŸen dosyalarÄ±nÄ±** ve **veritabanÄ± baÄŸlamÄ± sÄ±nÄ±fÄ±nÄ±** Ã¼retir:

ğŸ“ **Components/Pages/MoviePages**

* **Create.razor:** Yeni film kayÄ±tlarÄ± oluÅŸturur.
* **Delete.razor:** Film kayÄ±tlarÄ±nÄ± siler.
* **Details.razor:** Film ayrÄ±ntÄ±larÄ±nÄ± gÃ¶sterir.
* **Edit.razor:** Film kayÄ±tlarÄ±nÄ± dÃ¼zenler.
* **Index.razor:** VeritabanÄ±ndaki film kayÄ±tlarÄ±nÄ± listeler.

ğŸ“„ **Data/BlazorWebAppMoviesContext.cs:** VeritabanÄ± baÄŸlamÄ± (DbContext) sÄ±nÄ±f dosyasÄ±.

> ğŸ“ MoviePages klasÃ¶rÃ¼ndeki bileÅŸenler, bu eÄŸitim serisinin bir sonraki bÃ¶lÃ¼mÃ¼nde ayrÄ±ntÄ±lÄ± olarak aÃ§Ä±klanacaktÄ±r.
>
> VeritabanÄ± baÄŸlamÄ± bu bÃ¶lÃ¼mÃ¼n ilerleyen kÄ±smÄ±nda ele alÄ±nmaktadÄ±r.

---

## ğŸ’‰ ASP.NET Core ve BaÄŸÄ±mlÄ±lÄ±k Enjeksiyonu (Dependency Injection)

ASP.NET Core, sÄ±nÄ±flar ile baÄŸÄ±mlÄ±lÄ±klarÄ± arasÄ±ndaki **denetim tersine Ã§evrimi (Inversion of Control â€“ IoC)** ilkesini gerÃ§ekleÅŸtirmek iÃ§in **Dependency Injection (DI)** tasarÄ±m desenini kullanÄ±r.

Servisler (Ã¶rneÄŸin, EF Core veritabanÄ± baÄŸlamÄ±), uygulama baÅŸlatÄ±ldÄ±ÄŸÄ±nda DI konteynerine kaydedilir.

Bu servisler daha sonra Razor bileÅŸenlerine **enjeksiyon** yoluyla aktarÄ±lÄ±r.

---

## âš¡ QuickGrid bileÅŸeni

 **QuickGrid** , verileri tablo ÅŸeklinde verimli bir biÃ§imde gÃ¶stermek iÃ§in kullanÄ±lan bir Razor bileÅŸenidir.

Ä°skelet oluÅŸturucu, **Index.razor** bileÅŸenine bir QuickGrid ekleyerek film kayÄ±tlarÄ±nÄ±n tablo biÃ§iminde gÃ¶rÃ¼ntÃ¼lenmesini saÄŸlar.

EF Core tarafÄ±ndan saÄŸlanan `IQueryable<T>` sorgularÄ±nÄ± asenkron olarak Ã§Ã¶zÃ¼mleyebilmesi iÃ§in, servis koleksiyonuna ÅŸu satÄ±r eklenir:

```csharp
builder.Services.AddQuickGridEntityFrameworkAdapter();
```

---

## âš™ï¸ VeritabanÄ± hatalarÄ±nÄ±n yakalanmasÄ±

`AddDatabaseDeveloperPageExceptionFilter`, **Entity Framework** ile iliÅŸkili hatalarÄ± yakalayan bir filtre ekler.

Bu filtre, **UseDeveloperExceptionPage** ile birlikte Ã§alÄ±ÅŸarak hata durumunda olasÄ± Ã§Ã¶zÃ¼m yollarÄ±nÄ± iÃ§eren HTML hata sayfalarÄ± Ã¼retir.

Genellikle bu hatalar **EF Core migrations** iÅŸlemleriyle Ã§Ã¶zÃ¼lebilir.

---

## ğŸ§© Program.cs dosyasÄ±na eklenen kod

Ä°skelet oluÅŸturma iÅŸlemi, aÅŸaÄŸÄ±daki kodu **Program.cs** dosyasÄ±na ekler:

```csharp
builder.Services.AddDbContextFactory<BlazorWebAppMoviesContext>(options =>
    options.UseSqlServer(
        builder.Configuration.GetConnectionString("BlazorWebAppMoviesContext") ?? 
        throw new InvalidOperationException(
            "Connection string 'BlazorWebAppMoviesContext' not found.")));

builder.Services.AddQuickGridEntityFrameworkAdapter();

builder.Services.AddDatabaseDeveloperPageExceptionFilter();
```

---

## ğŸ—ï¸ EF Core ile ilk veritabanÄ± ÅŸemasÄ±nÄ± oluÅŸturma

### ğŸ”¹ Migration (geÃ§iÅŸ) Ã¶zelliÄŸi

EF Coreâ€™un **migration (geÃ§iÅŸ)** Ã¶zelliÄŸi:

* Ä°lk veritabanÄ± ÅŸemasÄ±nÄ± oluÅŸturur.
* VeritabanÄ± ÅŸemasÄ±nÄ± uygulamadaki veri modeliyle senkronize tutar.
* Mevcut verileri korur.

Bu iÅŸlem **code-first** yaklaÅŸÄ±mÄ± ile yapÄ±lÄ±r:

1. Ã–nce model sÄ±nÄ±flarÄ± oluÅŸturulur veya gÃ¼ncellenir.
2. EF Core, bu sÄ±nÄ±flara gÃ¶re veritabanÄ±nÄ± otomatik olarak oluÅŸturur veya gÃ¼nceller.

Bu yaklaÅŸÄ±m, **database-first** yÃ¶nteminin tersidir ve geliÅŸtirme sÃ¼recini hÄ±zlandÄ±rÄ±r.

---

## ğŸ§± Ä°lk migration (geÃ§iÅŸ) oluÅŸturma

1. **BlazorWebAppMovies.csproj** dosyasÄ±na saÄŸ tÄ±klayÄ±n ve **Open in Integrated Terminal** seÃ§eneÄŸini tÄ±klayÄ±n.

   VS Code Terminal penceresi proje kÃ¶k dizininde aÃ§Ä±lÄ±r.
2. AÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
dotnet ef migrations add InitialCreate
```

Bu komut, modelde tanÄ±mlanan ÅŸemaya gÃ¶re **ilk veritabanÄ± yapÄ±sÄ±nÄ±** oluÅŸturmak iÃ§in gerekli kodu Ã¼retir.

`InitialCreate` geÃ§iÅŸin adÄ±dÄ±r. Dilerseniz aÃ§Ä±klayÄ±cÄ± bir isim verebilirsiniz.

3. ArdÄ±ndan, veritabanÄ±nÄ± oluÅŸturmak iÃ§in ÅŸu komutu Ã§alÄ±ÅŸtÄ±rÄ±n:

```bash
dotnet ef database update
```

Bu komut, `Migrations/{ZAMAN_DAMGASI}_InitialCreate.cs` dosyasÄ±ndaki **Up()** metodunu Ã§alÄ±ÅŸtÄ±rarak veritabanÄ±nÄ± oluÅŸturur.

---

## ğŸ§  BlazorWebAppMoviesContext sÄ±nÄ±fÄ± (Data/BlazorWebAppMoviesContext.cs)

Bu sÄ±nÄ±f:

* `Microsoft.EntityFrameworkCore.DbContext` sÄ±nÄ±fÄ±ndan tÃ¼retilir.
* Veri modelinde yer alan varlÄ±klarÄ± (entity) tanÄ±mlar.
* EF Coreâ€™un CRUD iÅŸlevlerini koordine eder.
* `DbSet<TEntity>` Ã¶zelliÄŸi iÃ§erir.

EF Core terimleriyle:

* **Entity set (DbSet)** = VeritabanÄ±ndaki tablo,
* **Entity (varlÄ±k)** = Tablo satÄ±rÄ± anlamÄ±na gelir.

BaÄŸlantÄ± dizesi (connection string), `DbContextOptions` Ã¼zerinden geÃ§irilir ve **appsettings.json** dosyasÄ±ndan okunur.

---

âš ï¸ **UyarÄ±:**

Ä°stemci tarafÄ± kodunda aÅŸaÄŸÄ±daki bilgileri  **asla saklamayÄ±n** :

* Uygulama sÄ±rlarÄ±
* BaÄŸlantÄ± dizeleri
* Parolalar veya kimlik bilgileri
* PINâ€™ler veya gizli anahtarlar

Ãœretim ortamlarÄ±nda gÃ¼venli kimlik doÄŸrulama akÄ±ÅŸlarÄ± kullanÄ±lmalÄ±dÄ±r.

Yerel geliÅŸtirmede gizli verileri korumak iÃ§in **Secret Manager** aracÄ±nÄ± kullanÄ±n.

---

## ğŸ§ª UygulamayÄ± test etme

1. UygulamayÄ± Ã§alÄ±ÅŸtÄ±rÄ±n:
   ```bash
   dotnet watch
   ```
2. TarayÄ±cÄ±da aÅŸaÄŸÄ±daki URLâ€™ye gidin:
   ```
   http://localhost:{PORT}/movies
   ```
3. **Movies Index** sayfasÄ± aÃ§Ä±ldÄ±ÄŸÄ±nda, **Create New** baÄŸlantÄ±sÄ±na tÄ±klayÄ±n.
4. Yeni bir film kaydÄ± ekleyin. Ã–rneÄŸin:| Alan                   | DeÄŸer     |
   | ---------------------- | ---------- |
   | **Title**        | The Matrix |
   | **Release Date** | 1999       |
   | **Genre**        | Sci-Fi     |
   | **Price**        | 9.99       |
5. **Create** butonuna tÄ±kladÄ±ÄŸÄ±nÄ±zda film verileri sunucuya gÃ¶nderilir ve veritabanÄ±na kaydedilir.
6. **Index** sayfasÄ±na geri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼zde, yeni eklenen film listede gÃ¶rÃ¼nÃ¼r.

ğŸ–Šï¸ **Edit** sayfasÄ±ndan filmi dÃ¼zenleyebilir,

ğŸ—‘ï¸ **Delete** sayfasÄ±ndan silebilirsiniz (henÃ¼z silmeyin).

> âš ï¸ â€œThe Matrixâ€ kaydÄ±nÄ± silmeyin, Ã§Ã¼nkÃ¼ bu film sonraki eÄŸitim adÄ±mlarÄ±nda kullanÄ±lacaktÄ±r.
>
> EÄŸer yanlÄ±ÅŸlÄ±kla sildiyseniz, **Create** sayfasÄ±ndan tekrar ekleyin.

---

## â¹ï¸ UygulamayÄ± durdurma

UygulamayÄ± kapatmak iÃ§in:

* TarayÄ±cÄ± penceresini kapatÄ±n.
* VS Codeâ€™da:
  * MenÃ¼den **Run > Stop Debugging** seÃ§in, veya
  * Klavyeden **Shift + F5** tuÅŸlarÄ±na basÄ±n.

---

## ğŸ§© Sorun giderme

Bir hata ile karÅŸÄ±laÅŸÄ±rsanÄ±z kodunuzu ÅŸu Ã¶rnekle karÅŸÄ±laÅŸtÄ±rÄ±n:

**[Blazor Ã¶rnekleri GitHub deposu (dotnet/blazor-samples)](https://github.com/dotnet/blazor-samples)**

ğŸ“ Proje klasÃ¶rÃ¼: **BlazorWebAppMovies**

---

## ğŸ“š Ek kaynaklar

* [Entity Framework Core](https://learn.microsoft.com/ef/core)
* [EF Core CLI araÃ§ referansÄ±](https://learn.microsoft.com/ef/core/cli/dotnet)
* [ASP.NET Coreâ€™da Dependency Injection](https://learn.microsoft.com/aspnet/core/fundamentals/dependency-injection)
* [ASP.NET Core Blazor QuickGrid bileÅŸeni](https://learn.microsoft.com/aspnet/core/blazor/components/quickgrid)

---

Â© *The Matrix* â€” Warner Bros. Entertainment Inc.

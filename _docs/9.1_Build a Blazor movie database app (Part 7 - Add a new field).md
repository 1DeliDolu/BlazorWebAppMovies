
# ğŸ¬ Blazor film veritabanÄ± uygulamasÄ± (BÃ¶lÃ¼m 7 - Yeni bir alan ekleme)

## ğŸ§° AraÃ§ SeÃ§imi

Bu makale, **ASP.NET Core Blazor Web App** kullanarak film veritabanÄ± yÃ¶netimi Ã¶zelliklerine sahip bir uygulama oluÅŸturmanÄ±n temellerini Ã¶ÄŸreten **Blazor film veritabanÄ± Ã¶ÄŸreticisinin yedinci bÃ¶lÃ¼mÃ¼**dÃ¼r.

Bu bÃ¶lÃ¼m,  **Movie sÄ±nÄ±fÄ±na** , **CRUD sayfalarÄ±na** ve **veritabanÄ±na yeni bir alan (Rating)** eklemeyi kapsar.

---

## ğŸ§± EF Core Migrations ile veritabanÄ± gÃ¼ncellemesi

VeritabanÄ± gÃ¼ncellemeleri, **Entity Framework Core (EF Core)** tarafÄ±ndan saÄŸlanan **migrations (gÃ¶Ã§)** mekanizmasÄ±yla gerÃ§ekleÅŸtirilir.

EF Core, veritabanÄ±ndaki deÄŸiÅŸiklikleri **migration geÃ§miÅŸi tablosunda** izler ve **model sÄ±nÄ±flarÄ± veritabanÄ± tablolarÄ±yla uyumlu deÄŸilse hata** verir.

Bu sayede, **veritabanÄ± tutarlÄ±lÄ±ÄŸÄ±yla ilgili hatalar** kolayca tespit edilir.

> âš ï¸ **Ã–nemli:**
>
> AÅŸaÄŸÄ±daki adÄ±mlara geÃ§meden Ã¶nce uygulamanÄ±n Ã§alÄ±ÅŸmadÄ±ÄŸÄ±ndan emin ol.

---

## ğŸï¸ Modele film derecelendirmesi (Rating) ekleme

`Models/Movie.cs` dosyasÄ±nÄ± aÃ§ ve aÅŸaÄŸÄ±daki Ã¶zelliÄŸi ekle:

```csharp
[Required]
[RegularExpression(@"^(G|PG|PG-13|R|NC-17)$")]
public string? Rating { get; set; }
```

Bu dÃ¼zenli ifade, yalnÄ±zca **Motion Picture Association** tarafÄ±ndan belirlenen film derecelendirmelerine izin verir.

---

## ğŸ§© Rating alanÄ±nÄ± CRUD bileÅŸenlerine ekleme

### â• Create bileÅŸeni

`Components/Pages/MoviePages/Create.razor` dosyasÄ±nÄ± aÃ§.

**Price** bloÄŸu ile **Create** dÃ¼ÄŸmesi arasÄ±na aÅŸaÄŸÄ±daki kodu ekle:

```razor
<div class="mb-3">
    <label for="rating" class="form-label">Rating:</label> 
    <InputText id="rating" @bind-Value="Movie.Rating" class="form-control" /> 
    <ValidationMessage For="() => Movie.Rating" class="text-danger" /> 
</div>
```

---

### âŒ Delete bileÅŸeni

`Components/Pages/MoviePages/Delete.razor` dosyasÄ±nÄ± aÃ§.

**Price** iÃ§in olan `<dl>` bloÄŸu ile **EditForm** bileÅŸeni arasÄ±na ÅŸu kodu ekle:

```razor
<dl class="row">
    <dt class="col-sm-2">Rating</dt>
    <dd class="col-sm-10">@movie.Rating</dd>
</dl>
```

---

### ğŸ” Details bileÅŸeni

`Components/Pages/MoviePages/Details.razor` dosyasÄ±nÄ± aÃ§.

**Price** alanÄ±ndan sonra kapanÄ±ÅŸ `</dl>` etiketinin hemen Ã¶ncesine ÅŸu satÄ±rlarÄ± ekle:

```razor
<dt class="col-sm-2">Rating</dt>
<dd class="col-sm-10">@movie.Rating</dd>
```

---

### âœï¸ Edit bileÅŸeni

`Components/Pages/MoviePages/Edit.razor` dosyasÄ±nÄ± aÃ§.

**Price** bloÄŸu ile **Save** dÃ¼ÄŸmesi arasÄ±na ÅŸu kodu ekle:

```razor
<div class="mb-3">
    <label for="rating" class="form-label">Rating:</label>
    <InputText id="rating" @bind-Value="Movie.Rating" class="form-control" />
    <ValidationMessage For="() => Movie.Rating" class="text-danger" />
</div>
```

---

### ğŸ“‹ Index bileÅŸeni

`Components/Pages/MoviePages/Index.razor` dosyasÄ±nÄ± aÃ§.

**Price** sÃ¼tunundan hemen sonra aÅŸaÄŸÄ±daki sÃ¼tunu ekle:

```razor
<PropertyColumn Property="movie => movie.Rating" />
```

---

## ğŸŒ± SeedData sÄ±nÄ±fÄ±nÄ± gÃ¼ncelle

`Data/SeedData.cs` dosyasÄ±ndaki Mad Max film bloÄŸuna **Rating** ekle:

```diff
new Movie
{
    Title = "Mad Max",
    ReleaseDate = DateOnly.Parse("1979-4-12"),
    Genre = "Sci-fi (Cyberpunk)",
    Price = 2.51M,
+   Rating = "R",
},
```

AynÄ± iÅŸlemi diÄŸer filmler iÃ§in de yap:

| Film                        | Rating |
| --------------------------- | ------ |
| The Road Warrior            | R      |
| Mad Max: Beyond Thunderdome | PG-13  |
| Mad Max: Fury Road          | R      |
| Furiosa: A Mad Max Saga     | R      |

TÃ¼m dosyalarÄ± kaydet.

---

## ğŸ§± UygulamayÄ± derle

Komut paletinde **â€œ.NET: Buildâ€** komutunu Ã§alÄ±ÅŸtÄ±r.

Herhangi bir hata varsa dÃ¼zelt ve devam et.

HenÃ¼z uygulamayÄ± Ã§alÄ±ÅŸtÄ±rma.

---

## ğŸ—ƒï¸ VeritabanÄ±nÄ± gÃ¼ncelle

UygulamayÄ± ÅŸu anda Ã§alÄ±ÅŸtÄ±rÄ±rsan hata alÄ±rsÄ±n, Ã§Ã¼nkÃ¼ veritabanÄ±nda **Rating** sÃ¼tunu yok.

Bu farkÄ± gidermek iÃ§in Ã¼Ã§ yÃ¶ntem vardÄ±r:

1. **VeritabanÄ± ÅŸemasÄ±nÄ± elle deÄŸiÅŸtirmek**

   â†’ Verileri korur ama karmaÅŸÄ±ktÄ±r.
2. **VeritabanÄ±nÄ± silip yeniden oluÅŸturmak**

   â†’ HÄ±zlÄ±dÄ±r ama veriler kaybolur.
3. **EF Core Migration kullanmak (Ã¶nerilen)** âœ…

---

### ğŸ§­ Migration oluÅŸtur

Terminali aÃ§ ve proje kÃ¶k dizininde aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±r:

```bash
dotnet ef migrations add AddRatingField
```

Bu komut:

* Movie modeli ile veritabanÄ± tablosunu karÅŸÄ±laÅŸtÄ±rÄ±r,
* ÅemayÄ± eÅŸitlemek iÃ§in gerekli C# kodunu oluÅŸturur.

---

### âš™ï¸ Migration dosyasÄ±nÄ± dÃ¼zenle

`Migrations` klasÃ¶rÃ¼ndeki `{timestamp}_AddRatingField.cs` dosyasÄ±nÄ± aÃ§.

AÅŸaÄŸÄ±daki kÄ±smÄ± bul ve dÃ¼zenle:

```diff
migrationBuilder.AddColumn<string>(
    name: "Rating",
    table: "Movie",
    type: "nvarchar(max)",
    nullable: false,
-   defaultValue: "");
+   defaultValue: "R");
```

Kaydet.

---

### ğŸ—„ï¸ VeritabanÄ±nÄ± gÃ¼ncelle

AÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±r:

```bash
dotnet ef database update
```

Bu iÅŸlem mevcut verileri koruyarak **Rating** sÃ¼tununu ekler.

---

## âœï¸ R olmayan filmi gÃ¼ncelle

UygulamayÄ± Ã§alÄ±ÅŸtÄ±r:

1. **Mad Max: Beyond Thunderdome** filmini dÃ¼zenle.
2. **Rating** deÄŸerini  **R** â€™den  **PG-13** â€™e deÄŸiÅŸtir.
3. Kaydet.

> ğŸ’¡ Alternatif: Migration dosyasÄ±nÄ± dÃ¼zenlemek yerine veritabanÄ±nÄ± silip uygulamayÄ± yeniden Ã§alÄ±ÅŸtÄ±rarak tohumlama (reseeding) yapabilirsin.

---

## âœ… Yeni alanÄ± doÄŸrula

UygulamayÄ± Ã§alÄ±ÅŸtÄ±r ve film ekleme, dÃ¼zenleme ve gÃ¶rÃ¼ntÃ¼leme iÅŸlemlerini test et.

ArtÄ±k her film iÃ§in **Rating** alanÄ± dÃ¼zenlenebilir ve listelenebilir.

---

## ğŸ§° Sorun giderme

### ğŸ§¨ VeritabanÄ± bozulursa

1. VeritabanÄ±nÄ± sil.
2. Terminalde aÅŸaÄŸÄ±daki komutu Ã§alÄ±ÅŸtÄ±r:
   ```bash
   dotnet ef database update
   ```

---

### ğŸ§¹ KayÄ±tlarÄ± silip yeniden tohumlama

Yeni sÃ¼tunlara varsayÄ±lan deÄŸer atamak iÃ§in alternatif yÃ¶ntem:

1. TÃ¼m film kayÄ±tlarÄ±nÄ± sil:

   * Uygulamada â€œDeleteâ€ baÄŸlantÄ±larÄ±nÄ± kullanabilir,
   * Ya da SQL sorgusu ile:
     ```sql
     DELETE FROM dbo.Movie;
     ```
2. UygulamayÄ± yeniden Ã§alÄ±ÅŸtÄ±r.

   Tohumlama kodu, filmleri doÄŸru **Rating** deÄŸerleriyle yeniden oluÅŸturur.

> âš ï¸ **Dikkat:**
>
> VeritabanÄ± kayÄ±tlarÄ±nÄ± silmek kalÄ±cÄ±dÄ±r. Ãœretim ortamlarÄ±nda yedekleme kullanÄ±lmasÄ± gerekir.

---

## ğŸ§© TamamlanmÄ±ÅŸ Ã¶rnekle karÅŸÄ±laÅŸtÄ±r

Sorun yaÅŸarsan, projenin tamamlanmÄ±ÅŸ sÃ¼rÃ¼mÃ¼nÃ¼ kontrol et:

ğŸ”— **Blazor Ã¶rnekleri GitHub deposu (dotnet/blazor-samples)**

KlasÃ¶r adÄ±: **BlazorWebAppMovies**

---

## ğŸ“š Ek kaynaklar

* [Migrations (EF Core belgeleri)](https://learn.microsoft.com/ef/core/managing-schemas/migrations)
* [Migration kodunu Ã¶zelleÅŸtirme](https://learn.microsoft.com/ef/core/managing-schemas/migrations/customize)

# ğŸ§© Blazor film veritabanÄ± uygulamasÄ± oluÅŸturun (BÃ¶lÃ¼m 5 - DoÄŸrulama ekleme)

## ğŸ§° AraÃ§larÄ±nÄ±zÄ± seÃ§in

Bu makale, film veritabanÄ± yÃ¶netim Ã¶zelliklerine sahip bir **ASP.NET Core Blazor Web UygulamasÄ±** oluÅŸturmayÄ± Ã¶ÄŸreten serinin  **beÅŸinci bÃ¶lÃ¼mÃ¼dÃ¼r** .

Bu bÃ¶lÃ¼m, **Movie** modelindeki meta verilerin, film oluÅŸturma ve dÃ¼zenleme formlarÄ±nda kullanÄ±cÄ± giriÅŸini doÄŸrulamak iÃ§in nasÄ±l kullanÄ±ldÄ±ÄŸÄ±nÄ± aÃ§Ä±klar.

---

## âœ… Veri ek aÃ§Ä±klamalarÄ±yla (Data Annotations) doÄŸrulama

DoÄŸrulama kurallarÄ±, bir model sÄ±nÄ±fÄ±nda **data annotations** (veri ek aÃ§Ä±klamalarÄ±) kullanÄ±larak belirtilir.

AÅŸaÄŸÄ±da, form modellerinde genel Ã¶zelliklerin kullanÄ±cÄ± giriÅŸini doÄŸrulamak iÃ§in kullanÄ±lan bazÄ± `System.ComponentModel.DataAnnotations` Ã¶znitelikleri verilmiÅŸtir:

* **[Required]** â†’ KullanÄ±cÄ±nÄ±n bir deÄŸer girmesini zorunlu kÄ±lar.
* **[StringLength]** â†’ Minimum ve maksimum karakter uzunluÄŸunu belirtir.

  (Not: `MinimumLength` deÄŸeri, alanÄ± zorunlu hale getirmez â€” bunun iÃ§in ayrÄ±ca `[Required]` gerekir.)
* **[RegularExpression]** â†’ KullanÄ±cÄ± giriÅŸinin belirli bir desenle eÅŸleÅŸmesini saÄŸlar.
* **[Range]** â†’ Minimum ve maksimum sayÄ±sal deÄŸeri belirtir.

> ğŸ’¡ `decimal`, `int`, `float`, `DateOnly`, `TimeOnly` ve `DateTime` gibi deÄŸer tÃ¼rleri zaten zorunludur; bu nedenle `[Required]` eklenmesine gerek yoktur.

Ek veri ek aÃ§Ä±klamalarÄ± hakkÄ±nda daha fazla bilgi iÃ§in **Blazor belgelerine** baÅŸvurabilirsiniz.

---

## ğŸ¬ Movie modeline doÄŸrulama ekleme

AÅŸaÄŸÄ±daki doÄŸrulama Ã¶zniteliklerini `Movie` sÄ±nÄ±fÄ±na ekleyin.

TÃ¼m Ã¶zellikleri bir kerede gÃ¼ncellemek iÃ§in aÅŸaÄŸÄ±daki tam dosyayÄ± kopyalayÄ±p yapÄ±ÅŸtÄ±rabilirsiniz.

### ğŸ”§ Eklenen veya gÃ¼ncellenen Ã¶znitelikler:

```diff
+ [Required]
+ [StringLength(60, MinimumLength = 3)]
  public string? Title { get; set; }

+ [Required]
* [StringLength(30)]
+ [RegularExpression(@"^[A-Z]+[a-zA-Z()\s-]*$")]
  public string? Genre { get; set; }

+ [Range(0, 100)]
  [DataType(DataType.Currency)]
  [Column(TypeName = "decimal(18, 2)")]
  public decimal Price { get; set; }
```

---

ğŸ“„ **Models/Movie.cs** (tam hali):

```csharp
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace BlazorWebAppMovies.Models;

public class Movie
{
    public int Id { get; set; }

    [Required]
    [StringLength(60, MinimumLength = 3)]
    public string? Title { get; set; }

    public DateOnly ReleaseDate { get; set; }

    [Required]
    [StringLength(30)]
    [RegularExpression(@"^[A-Z]+[a-zA-Z()\s-]*$")]
    public string? Genre { get; set; }

    [Range(0, 100)]
    [DataType(DataType.Currency)]
    [Column(TypeName = "decimal(18, 2)")]
    public decimal Price { get; set; }
}
```

> âš ï¸ YukarÄ±daki doÄŸrulama kurallarÄ± sadece **Ã¶rnek amaÃ§lÄ±dÄ±r** ve Ã¼retim ortamlarÄ± iÃ§in ideal deÄŸildir.
>
> Ã–rneÄŸin, yalnÄ±zca iki karakterden oluÅŸan film adlarÄ±nÄ± reddeder ve tÃ¼r (genre) alanÄ±nda Ã¶zel karakterlere izin vermez.

---

## ğŸ§± EF Core Migration oluÅŸturma ve veritabanÄ±nÄ± gÃ¼ncelleme

Bir  **veri modeli ÅŸemasÄ±** , verilerin iliÅŸkisel bir veritabanÄ±nda nasÄ±l dÃ¼zenlendiÄŸini ve birbirine baÄŸlandÄ±ÄŸÄ±nÄ± tanÄ±mlar.

Ancak, `Movie` sÄ±nÄ±fÄ±na ek aÃ§Ä±klamalar eklemek, veritabanÄ± ÅŸemasÄ±nÄ± **otomatik olarak** gÃ¼ncellemez.

---

### ğŸ¯ Title Ã¶zelliÄŸi Ã¶rneÄŸi:

```csharp
[Required]
[StringLength(60, MinimumLength = 3)]
public string? Title { get; set; }
```

| KÄ±sÄ±tlama      | Model (Title property) | VeritabanÄ± (Title sÃ¼tunu)    |
| ---------------- | ---------------------- | ------------------------------ |
| Maksimum uzunluk | 60 karakter            | NVARCHAR(MAX) (~2 GBâ€™a kadar) |
| Zorunlu          | âœ”ï¸`[Required]`     | âŒ NULL deÄŸerine izin verilir |

> ğŸ’¡ VeritabanÄ±nda 2 GBâ€™a kadar karakter saklanabilir, bu da modeldeki 60 karakter sÄ±nÄ±rÄ±ndan Ã§ok fazladÄ±r.
>
> Bu fark, modelle veritabanÄ± arasÄ±nda **uyumsuzluk** yaratÄ±r.

---

### ğŸ§© ÅemayÄ± modelle uyumlu hale getirme

VeritabanÄ± sÃ¼tunu:

* `NVARCHAR(60)` olarak ayarlanmalÄ±dÄ±r.
* `NOT NULL` olmalÄ±dÄ±r (Ã§Ã¼nkÃ¼ `[Required]`).

> Modelde `string?` (nullable reference type) kullanÄ±lmasÄ±, veritabanÄ±nÄ±n da `NULL` deÄŸer kabul edeceÄŸi anlamÄ±na gelmez.
>
> Kodda `null` deÄŸer hatalarÄ±nÄ± Ã¶nlemek iÃ§in NRT kullanÄ±lÄ±r, veritabanÄ±nda ise veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlamak iÃ§in `NOT NULL` tanÄ±mlanÄ±r.

---

## ğŸ§­ EF Core Migration oluÅŸturma adÄ±mlarÄ±

Model ile veritabanÄ± ÅŸemasÄ±nÄ± senkronize etmek iÃ§in yeni bir migration oluÅŸturun.

> âš ï¸ **Devam etmeden Ã¶nce uygulamanÄ±n Ã§alÄ±ÅŸmadÄ±ÄŸÄ±ndan emin olun.**

### ğŸ”´ UygulamayÄ± durdurma yollarÄ±:

* **Visual Studio:** TarayÄ±cÄ± penceresini kapatÄ±n.
* **VS Code:** TarayÄ±cÄ±yÄ± kapatÄ±n, ardÄ±ndan **Run > Stop Debugging** veya `Shift+F5` tuÅŸuna basÄ±n.
* **.NET CLI:** TarayÄ±cÄ±yÄ± kapatÄ±n ve komut satÄ±rÄ±nda `Ctrl+C` tuÅŸlarÄ±na basÄ±n.

---

### ğŸ› ï¸ Migration ekleme

Proje kÃ¶k dizininde yeni bir migration oluÅŸturun:

```bash
dotnet ef migrations add NewMovieDataAnnotations
```

### ğŸ’¾ Migrationâ€™Ä± veritabanÄ±na uygulama

```bash
dotnet ef database update
```

---

## ğŸ” Migration sonrasÄ± ÅŸema uyumu

| KÄ±sÄ±tlama      | Model (Title property) | VeritabanÄ± (Title sÃ¼tunu) |
| ---------------- | ---------------------- | --------------------------- |
| Maksimum uzunluk | 60 karakter            | NVARCHAR(60)                |
| Zorunluluk       | âœ”ï¸`[Required]`     | âœ”ï¸`NOT NULL`            |

> ğŸ’¡ `NVARCHAR(60)` sÃ¼tunu, Unicode aralÄ±ÄŸÄ± 0â€“65.535 iÃ§indeki karakterler iÃ§in 60 karakter depolayabilir.

---

## ğŸ§© Sorun giderme

EÄŸitim sÄ±rasÄ±nda Ã§Ã¶zÃ¼mleyemediÄŸiniz bir hata oluÅŸursa, kodunuzu **tamamlanmÄ±ÅŸ Ã¶rnek proje**yle karÅŸÄ±laÅŸtÄ±rÄ±n:

ğŸ”— [Blazor samples GitHub repository (dotnet/blazor-samples)](https://github.com/dotnet/blazor-samples)

Bu eÄŸitimin proje klasÃ¶rÃ¼: **BlazorWebAppMovies**

---

## ğŸ“š Ek kaynaklar

* Tag Helpers in forms in ASP.NET Core
* Globalization and localization in ASP.NET Core
* Author Tag Helpers in ASP.NET Core
* Migrations overview (EF Core documentation)
* nchar and nvarchar (Transact-SQL) (SQL Server documentation)
* Blazor enhanced forms

---
